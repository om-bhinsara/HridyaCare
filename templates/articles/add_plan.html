<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Medication Reminder | HridyaCare</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
    :root {
        --bg: #0b1121;
        --card: rgba(30, 41, 59, 0.7);
        --card-border: rgba(255, 255, 255, 0.08);
        --text: #f1f5f9;
        --muted: #94a3b8;
        --accent: #3b82f6;
        --accent-glow: rgba(59, 130, 246, 0.4);
        --success: #10b981;
        --success-glow: rgba(16, 185, 129, 0.3);
        --danger: #ef4444;
    }

    * { box-sizing: border-box; font-family: 'Inter', sans-serif; transition: all 0.2s cubic-bezier(0.25, 0.8, 0.25, 1); }

    body {
        margin: 0;
        background: radial-gradient(circle at top right, #172554 0%, var(--bg) 40%);
        background-attachment: fixed;
        color: var(--text);
        padding-bottom: 90px;
        min-height: 100vh;
    }

    /* Header */
    .header {
        padding: 24px 20px;
        display: flex;
        align-items: center;
        gap: 16px;
        background: rgba(11, 17, 33, 0.85);
        backdrop-filter: blur(16px);
        -webkit-backdrop-filter: blur(16px);
        position: sticky;
        top: 0;
        z-index: 100;
        border-bottom: 1px solid var(--card-border);
    }
    .back-btn { 
        text-decoration: none; 
        color: var(--muted); 
        font-size: 24px; 
        padding: 4px;
        border-radius: 8px;
    }
    .back-btn:hover { background: rgba(255,255,255,0.1); color: #fff; }
    h2 { 
        margin: 0; 
        font-size: 22px; 
        font-weight: 700; 
        letter-spacing: -0.5px;
        background: linear-gradient(to right, #fff, #cbd5e1);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }

    /* Calendar Strip */
    .calendar-strip {
        display: flex;
        gap: 12px;
        padding: 10px 20px 25px 20px;
        overflow-x: auto;
        scrollbar-width: none;
    }
    .calendar-strip::-webkit-scrollbar { display: none; }
    
    .date-pill {
        display: flex;
        flex-direction: column;
        align-items: center;
        background: var(--card);
        padding: 14px 16px;
        border-radius: 16px;
        min-width: 64px;
        border: 1px solid var(--card-border);
        cursor: pointer;
        position: relative;
        overflow: hidden;
    }
    .date-pill:hover {
        transform: translateY(-2px);
        background: rgba(255,255,255,0.08);
    }
    .date-pill.active {
        background: linear-gradient(135deg, var(--accent), #2563eb);
        border-color: rgba(59, 130, 246, 0.5);
        box-shadow: 0 8px 20px var(--accent-glow);
    }
    .day { font-size: 11px; font-weight: 600; text-transform: uppercase; color: var(--muted); margin-bottom: 6px; letter-spacing: 0.5px; }
    .date-pill.active .day { color: rgba(255,255,255,0.9); }
    .date-num { font-size: 20px; font-weight: 800; line-height: 1; }

    /* Progress Card */
    .progress-container {
        padding: 0 20px;
        margin-bottom: 30px;
    }
    .progress-card {
        background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);
        border-radius: 24px;
        padding: 24px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 10px 30px rgba(37, 99, 235, 0.25);
        border: 1px solid rgba(255,255,255,0.1);
        position: relative;
        overflow: hidden;
    }
    .progress-card::before {
        content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
        background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 60%);
        pointer-events: none;
    }

    .prog-text { position: relative; z-index: 2; }
    .prog-text h4 { margin: 0 0 6px 0; font-size: 18px; font-weight: 700; color: #fff; }
    .prog-text p { margin: 0; font-size: 13px; color: rgba(255,255,255,0.8); font-weight: 500; }
    
    .ring-container {
        position: relative;
        width: 64px; height: 64px;
        display: flex; justify-content: center; align-items: center;
        z-index: 2;
    }
    .ring {
        width: 100%; height: 100%;
        border-radius: 50%;
        background: conic-gradient(#fff var(--p, 0%), rgba(255,255,255,0.1) 0);
        position: relative;
        display: flex; justify-content: center; align-items: center;
        box-shadow: 0 0 20px rgba(255,255,255,0.2);
    }
    .ring::after {
        content: '';
        position: absolute;
        width: 86%; height: 86%;
        background: #1e40af;
        border-radius: 50%;
    }
    .ring-val { position: absolute; z-index: 3; font-size: 13px; font-weight: 800; color: #fff; }

    /* Timeline Section */
    .timeline-section { padding: 0 20px; }
    .time-header {
        color: var(--muted);
        font-size: 12px;
        font-weight: 700;
        margin: 24px 0 12px 0;
        text-transform: uppercase;
        letter-spacing: 1.2px;
        display: flex; align-items: center; gap: 8px;
    }
    .time-header::after {
        content: ''; flex: 1; height: 1px; background: var(--card-border);
    }

    /* Med Item Card */
    .med-item {
        background: var(--card);
        border: 1px solid var(--card-border);
        border-radius: 18px;
        padding: 16px;
        display: flex;
        align-items: center;
        gap: 16px;
        margin-bottom: 14px;
        cursor: pointer;
        position: relative;
        backdrop-filter: blur(10px);
    }
    .med-item:hover {
        background: rgba(30, 41, 59, 0.9);
        border-color: rgba(255,255,255,0.15);
        transform: translateY(-2px);
    }
    .med-item:active { transform: scale(0.98); }

    .med-icon {
        width: 48px; height: 48px;
        background: rgba(59, 130, 246, 0.15);
        border-radius: 14px;
        display: flex; align-items: center; justify-content: center;
        font-size: 22px;
        color: var(--accent);
        box-shadow: inset 0 0 10px rgba(59, 130, 246, 0.1);
    }
    .med-info { flex: 1; }
    .med-name { font-weight: 700; font-size: 16px; display: block; margin-bottom: 4px; color: var(--text); }
    .med-dosage { font-size: 13px; color: var(--muted); font-weight: 500; }
    
    .check-btn {
        width: 36px; height: 36px;
        border-radius: 50%;
        border: 2px solid #475569;
        background: transparent;
        cursor: pointer;
        display: flex; align-items: center; justify-content: center;
        color: transparent;
        transition: 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        font-size: 18px;
    }
    
    .med-item.taken { 
        background: rgba(16, 185, 129, 0.05);
        border-color: rgba(16, 185, 129, 0.2);
    }
    .med-item.taken .med-icon {
        background: rgba(16, 185, 129, 0.15);
        color: var(--success);
    }
    .med-item.taken .check-btn {
        background: var(--success);
        border-color: var(--success);
        color: white;
        transform: scale(1.1);
        box-shadow: 0 0 15px var(--success-glow);
    }
    .med-item.taken .med-name { 
        text-decoration: line-through; 
        color: var(--muted); 
    }

    /* Floating Add Button */
    .fab {
        position: fixed;
        bottom: 30px;
        right: 25px;
        width: 60px; height: 60px;
        background: var(--accent);
        border-radius: 50%;
        display: flex; align-items: center; justify-content: center;
        font-size: 32px;
        color: white;
        box-shadow: 0 8px 25px rgba(59, 130, 246, 0.5);
        border: none;
        cursor: pointer;
        z-index: 101;
        transition: transform 0.3s;
    }
    .fab:hover { transform: scale(1.1) rotate(90deg); }

    /* Empty State */
    .empty-state {
        text-align: center;
        padding: 40px 20px;
        color: var(--muted);
        background: rgba(255,255,255,0.03);
        border-radius: 20px;
        border: 1px dashed var(--card-border);
    }

    /* ================= MODAL STYLES ================= */
    .modal-overlay {
        position: fixed;
        top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.8);
        backdrop-filter: blur(8px);
        z-index: 1000;
        display: none;
        justify-content: center;
        align-items: flex-end; /* Bottom sheet on mobile */
    }
    .modal-overlay.open { display: flex; animation: fadeIn 0.3s; }

    .modal-content {
        background: #1e293b;
        width: 100%;
        max-width: 500px;
        border-radius: 24px 24px 0 0; /* Rounded top */
        padding: 24px;
        box-shadow: 0 -10px 40px rgba(0,0,0,0.5);
        animation: slideUp 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
        border-top: 1px solid rgba(255,255,255,0.1);
    }
    
    @media (min-width: 600px) {
        .modal-overlay { align-items: center; }
        .modal-content { border-radius: 24px; }
    }

    .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; }
    .modal-title { font-size: 20px; font-weight: 700; }
    .close-btn { background: none; border: none; color: var(--muted); font-size: 28px; cursor: pointer; padding: 0; }

    .form-group { margin-bottom: 20px; }
    .form-label { display: block; font-size: 13px; color: var(--muted); margin-bottom: 8px; }
    .form-input { 
        width: 100%; 
        padding: 14px; 
        background: rgba(0,0,0,0.3); 
        border: 1px solid rgba(255,255,255,0.1); 
        border-radius: 12px; 
        color: white; 
        font-size: 16px; 
        outline: none;
    }
    .form-input:focus { border-color: var(--accent); }

    /* Time Selection Cards */
    .time-selector { display: flex; gap: 10px; }
    .time-option {
        flex: 1;
        background: rgba(255,255,255,0.05);
        border: 1px solid rgba(255,255,255,0.1);
        padding: 12px;
        border-radius: 12px;
        text-align: center;
        cursor: pointer;
        transition: 0.2s;
    }
    .time-option.selected {
        background: var(--accent);
        border-color: var(--accent);
        box-shadow: 0 4px 12px var(--accent-glow);
    }
    .time-icon { font-size: 20px; margin-bottom: 4px; display: block; }
    .time-name { font-size: 12px; font-weight: 600; }

    .btn-save {
        width: 100%;
        padding: 16px;
        background: var(--success);
        color: white;
        border: none;
        border-radius: 14px;
        font-size: 16px;
        font-weight: 700;
        cursor: pointer;
        margin-top: 10px;
    }

    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }

</style>
</head>
<body>

<div class="header">
    <a href="/health" class="back-btn">‚Üê</a>
    <h2>Medication Schedule</h2>
</div>

<div class="calendar-strip" id="calendarContainer"></div>

<div class="progress-container">
    <div class="progress-card">
        <div class="prog-text">
            <h4>Daily Progress</h4>
            <p id="progressText">0 of 0 medicines taken</p>
        </div>
        <div class="ring-container">
            <div class="ring" id="progressRing" style="--p: 0%"></div>
            <span class="ring-val" id="progressPercent">0%</span>
        </div>
    </div>
</div>

<div class="timeline-section" id="timelineContainer">
    <div class="empty-state">
        <div style="font-size:32px; margin-bottom:10px;">üíä</div>
        No medications added yet.<br>Tap the + button to add one.
    </div>
</div>

<button class="fab" onclick="openModal()">+</button>

<div class="modal-overlay" id="addModal">
    <div class="modal-content">
        <div class="modal-header">
            <span class="modal-title">Add Medication</span>
            <button class="close-btn" onclick="closeModal()">√ó</button>
        </div>
        
        <div class="form-group">
            <label class="form-label">Medicine Name</label>
            <input type="text" class="form-input" id="medNameInput" placeholder="e.g. Aspirin">
        </div>
        
        <div class="form-group">
            <label class="form-label">Dosage (Optional)</label>
            <input type="text" class="form-input" id="medDosageInput" placeholder="e.g. 100mg">
        </div>

        <div class="form-group">
            <label class="form-label">Schedule Time</label>
            <div class="time-selector">
                <div class="time-option selected" onclick="selectTime(this, 'Morning')">
                    <span class="time-icon">‚òÄÔ∏è</span>
                    <span class="time-name">Morning</span>
                </div>
                <div class="time-option" onclick="selectTime(this, 'Afternoon')">
                    <span class="time-icon">‚õÖ</span>
                    <span class="time-name">Afternoon</span>
                </div>
                <div class="time-option" onclick="selectTime(this, 'Evening')">
                    <span class="time-icon">üåô</span>
                    <span class="time-name">Evening</span>
                </div>
            </div>
        </div>

        <button class="btn-save" onclick="saveMedication()">Save Medication</button>
    </div>
</div>

<script>
    // --- STATE ---
    const state = {
        medications: [], // Starts EMPTY as requested
        selectedTime: 'Morning'
    };

    // --- INITIALIZATION ---
    document.addEventListener("DOMContentLoaded", () => {
        renderCalendar();
        updateProgress();
    });

    // --- FUNCTIONS ---

    function renderCalendar() {
        const container = document.getElementById('calendarContainer');
        container.innerHTML = '';
        const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
        const today = new Date();
        
        for (let i = -2; i <= 2; i++) {
            const date = new Date(today);
            date.setDate(today.getDate() + i);
            const isToday = i === 0;
            const dayName = days[date.getDay()];
            const dayNum = date.getDate();
            
            const pill = document.createElement('div');
            pill.className = `date-pill ${isToday ? 'active' : ''}`;
            pill.innerHTML = `<span class="day">${dayName}</span><span class="date-num">${dayNum}</span>`;
            pill.onclick = () => {
                document.querySelectorAll('.date-pill').forEach(p => p.classList.remove('active'));
                pill.classList.add('active');
            };
            container.appendChild(pill);
        }
    }

    function renderMeds() {
        const container = document.getElementById('timelineContainer');
        container.innerHTML = '';

        if (state.medications.length === 0) {
            container.innerHTML = `
            <div class="empty-state">
                <div style="font-size:32px; margin-bottom:10px;">üíä</div>
                No medications added.<br>Tap + to start your schedule.
            </div>`;
            return;
        }

        const groups = {
            "Morning": state.medications.filter(m => m.time === "Morning"),
            "Afternoon": state.medications.filter(m => m.time === "Afternoon"),
            "Evening": state.medications.filter(m => m.time === "Evening")
        };

        const headers = {
            "Morning": "‚òÄÔ∏è Morning",
            "Afternoon": "‚õÖ Afternoon",
            "Evening": "üåô Evening"
        };

        for (const [time, meds] of Object.entries(groups)) {
            if (meds.length > 0) {
                const header = document.createElement('div');
                header.className = 'time-header';
                header.innerText = headers[time];
                container.appendChild(header);

                meds.forEach(med => {
                    const item = document.createElement('div');
                    item.className = `med-item ${med.taken ? 'taken' : ''}`;
                    item.onclick = () => toggleMed(med.id);
                    
                    let icon = med.time === 'Morning' ? '‚òÄÔ∏è' : (med.time === 'Afternoon' ? '‚õÖ' : 'üåô');
                    
                    item.innerHTML = `
                        <div class="med-icon">${icon}</div>
                        <div class="med-info">
                            <span class="med-name">${med.name}</span>
                            <span class="med-dosage">${med.dosage}</span>
                        </div>
                        <div class="check-btn">‚úì</div>
                    `;
                    container.appendChild(item);
                });
            }
        }
    }

    function updateProgress() {
        const total = state.medications.length;
        const taken = state.medications.filter(m => m.taken).length;
        const percent = total === 0 ? 0 : Math.round((taken / total) * 100);

        document.getElementById('progressText').innerText = total === 0 ? "No meds scheduled" : `${taken} of ${total} medicines taken`;
        document.getElementById('progressPercent').innerText = `${percent}%`;
        document.getElementById('progressRing').style.setProperty('--p', `${percent}%`);
    }

    // --- ACTIONS ---

    function toggleMed(id) {
        const med = state.medications.find(m => m.id === id);
        if (med) {
            med.taken = !med.taken;
            renderMeds();
            updateProgress();
        }
    }

    // --- MODAL LOGIC ---

    function openModal() {
        document.getElementById('addModal').classList.add('open');
        // Reset Inputs
        document.getElementById('medNameInput').value = '';
        document.getElementById('medDosageInput').value = '';
        state.selectedTime = 'Morning';
        updateTimeSelectionUI();
    }

    function closeModal() {
        document.getElementById('addModal').classList.remove('open');
    }

    function selectTime(el, time) {
        state.selectedTime = time;
        updateTimeSelectionUI();
    }

    function updateTimeSelectionUI() {
        document.querySelectorAll('.time-option').forEach(opt => {
            if (opt.innerText.includes(state.selectedTime)) {
                opt.classList.add('selected');
            } else {
                opt.classList.remove('selected');
            }
        });
    }

    function saveMedication() {
        const name = document.getElementById('medNameInput').value;
        const dosage = document.getElementById('medDosageInput').value || 'Standard Dose';
        
        if (!name) {
            alert("Please enter a medication name.");
            return;
        }

        const newMed = {
            id: Date.now(),
            name: name,
            dosage: dosage,
            time: state.selectedTime,
            taken: false
        };

        state.medications.push(newMed);
        
        // Sort roughly by time logic
        const timeOrder = { "Morning": 1, "Afternoon": 2, "Evening": 3 };
        state.medications.sort((a, b) => timeOrder[a.time] - timeOrder[b.time]);

        renderMeds();
        updateProgress();
        closeModal();
    }
</script>

</body>
</html>